# Script pour créer un ZIP du projet sans node_modules
$sourceDir = "C:\Users\DarkNode\Desktop\Projet Web\Angeline-live"
$zipPath = "C:\Users\DarkNode\Desktop\Angeline-live-sans-node_modules.zip"

Write-Host "Création du ZIP sans node_modules..." -ForegroundColor Cyan

# Supprimer le ZIP s'il existe déjà
if (Test-Path $zipPath) {
    Remove-Item $zipPath -Force
    Write-Host "Ancien ZIP supprimé" -ForegroundColor Yellow
}

# Créer un dossier temporaire
$tempDir = Join-Path $env:TEMP "Angeline-live-temp"
if (Test-Path $tempDir) {
    Remove-Item $tempDir -Recurse -Force
}
New-Item -ItemType Directory -Path $tempDir | Out-Null

Write-Host "Copie des fichiers (exclusion: node_modules, .git, dist, .next)..." -ForegroundColor Cyan

# Copier tous les fichiers sauf node_modules, .git, dist, .next
Get-ChildItem -Path $sourceDir -Recurse | Where-Object {
    $_.FullName -notmatch '\\node_modules\\' -and
    $_.FullName -notmatch '\\.git\\' -and
    $_.FullName -notmatch '\\dist\\' -and
    $_.FullName -notmatch '\\.next\\' -and
    $_.FullName -notmatch '\\logs\\' -and
    $_.Name -ne 'create_zip_no_node_modules.ps1'
} | ForEach-Object {
    $relativePath = $_.FullName.Substring($sourceDir.Length + 1)
    $targetPath = Join-Path $tempDir $relativePath
    
    if ($_.PSIsContainer) {
        if (-not (Test-Path $targetPath)) {
            New-Item -ItemType Directory -Path $targetPath -Force | Out-Null
        }
    }
    else {
        $targetDir = Split-Path $targetPath -Parent
        if (-not (Test-Path $targetDir)) {
            New-Item -ItemType Directory -Path $targetDir -Force | Out-Null
        }
        Copy-Item $_.FullName -Destination $targetPath -Force
    }
}

Write-Host "Compression en cours..." -ForegroundColor Cyan

# Créer le ZIP
Compress-Archive -Path "$tempDir\*" -DestinationPath $zipPath -CompressionLevel Optimal -Force

# Nettoyer le dossier temporaire
Remove-Item $tempDir -Recurse -Force

# Afficher la taille du ZIP
$zipSize = (Get-Item $zipPath).Length / 1MB
Write-Host "✅ ZIP créé avec succès!" -ForegroundColor Green
Write-Host "Emplacement: $zipPath" -ForegroundColor White
Write-Host "Taille: $([math]::Round($zipSize, 2)) MB" -ForegroundColor White

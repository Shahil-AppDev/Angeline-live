# Push to GitHub without node_modules
$repoUrl = "https://github.com/Shahil-AppDev/Angeline-live.git"

Write-Host ""
Write-Host "Push vers GitHub (sans node_modules)" -ForegroundColor Cyan
Write-Host "Repo: $repoUrl" -ForegroundColor Cyan
Write-Host ""

# Verification Git
try {
    $gitVersion = git --version
    Write-Host "Git: $gitVersion" -ForegroundColor Green
}
catch {
    Write-Host "Git non installe" -ForegroundColor Red
    exit 1
}

Write-Host ""

# Aller dans le projet
$projectPath = $PSScriptRoot
Set-Location $projectPath

# Supprimer .git
if (Test-Path ".git") {
    Write-Host "Suppression ancien .git..." -ForegroundColor Yellow
    Remove-Item ".git" -Recurse -Force
}

# S'assurer que .gitignore contient node_modules
$gitignoreContent = "node_modules`n"
Set-Content -Path ".gitignore" -Value $gitignoreContent -Encoding UTF8

Write-Host ".gitignore configure pour exclure node_modules" -ForegroundColor Green

# Initialiser Git
Write-Host "Initialisation Git..." -ForegroundColor Yellow
git init
git branch -M main

# Configurer identite
git config user.name "Shahil-AppDev"
git config user.email "shahil.appdev@gmail.com"

# Ajouter tous les fichiers (sauf node_modules grace au .gitignore)
Write-Host "Ajout de tous les fichiers (sauf node_modules)..." -ForegroundColor Yellow
git add -A

$filesCount = (git status --short | Measure-Object).Count
Write-Host "$filesCount fichiers ajoutes" -ForegroundColor Green

# Verification Oracle Mystica
$oracleFiles = (Get-ChildItem "assets\oracles_assets\ORACLE_MYSTICA" -Recurse -File | Measure-Object).Count
Write-Host "$oracleFiles fichiers Oracle Mystica detectes" -ForegroundColor Green

# Commit
Write-Host "Creation commit..." -ForegroundColor Yellow
$commitMessage = @"
Initial commit - Angeline Live v2

Systeme complet de live TikTok automatise avec oracle MYSTICA

Contenu:
- 12 agents (TikTok, IA, Oracle, Response, OBS, System)
- 189 cartes Oracle Mystica recadrees (500x888px)
  - CORE: 145 cartes
  - EXTENSIONS/SENTIMENTAL: 27 cartes + dos
  - EXTENSIONS/TRAVAIL: 17 cartes + dos
- Videos (BG_LOOP, FX_SMOKE)
- Formation PDF Maitriser l'art des Oracles
- Web-admin Next.js complet
- Documentation complete
- Configurations (.env inclus avec DeepSeek API)

Note: node_modules exclus (reinstaller avec npm install)
"@

git commit -m $commitMessage

# Ajouter remote
Write-Host "Ajout remote GitHub..." -ForegroundColor Yellow
git remote add origin $repoUrl

# Push
Write-Host "Push vers GitHub (2-5 minutes sans node_modules)..." -ForegroundColor Green
git push -u origin main --force

if ($LASTEXITCODE -eq 0) {
    Write-Host ""
    Write-Host "PUSH REUSSI !" -ForegroundColor Green
    Write-Host "Repo: $repoUrl" -ForegroundColor Cyan
    Write-Host ""
    Write-Host "Sur l'autre PC:" -ForegroundColor Cyan
    Write-Host "  git clone $repoUrl" -ForegroundColor White
    Write-Host "  cd Angeline-live" -ForegroundColor White
    Write-Host "  npm install" -ForegroundColor White
    Write-Host ""
    Write-Host "IMPORTANT: Mettez le repo en PRIVE !" -ForegroundColor Red
    Write-Host "https://github.com/Shahil-AppDev/Angeline-live/settings" -ForegroundColor Yellow
}
else {
    Write-Host "ERREUR lors du push" -ForegroundColor Red
}

Write-Host ""
Write-Host "Appuyez sur une touche..." -ForegroundColor Gray
$null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")
